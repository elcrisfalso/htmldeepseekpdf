<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de PDFs con Edici√≥n de Texto</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4cb5f5;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .app-description {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            min-height: 600px;
        }
        
        .toolbar {
            width: 280px;
            background: var(--light-color);
            padding: 20px;
            border-right: 1px solid #ddd;
        }
        
        .toolbar-section {
            margin-bottom: 25px;
        }
        
        .toolbar-section h3 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--accent-color);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 12px 15px;
            margin: 8px 0;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            text-align: left;
        }
        
        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn i {
            margin-right: 10px;
        }
        
        .btn-danger {
            background: var(--danger-color);
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-success {
            background: var(--success-color);
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: var(--dark-color);
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .format-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .format-options .btn {
            text-align: center;
            padding: 10px;
        }
        
        .viewer-container {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .upload-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .drop-area {
            border: 2px dashed var(--accent-color);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .drop-area:hover {
            background-color: rgba(76, 181, 245, 0.1);
        }
        
        .drop-area p {
            margin-bottom: 10px;
            color: var(--secondary-color);
            font-size: 18px;
        }
        
        .pdf-container {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: auto;
            position: relative;
            background: #f9f9f9;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }
        
        #pdf-canvas {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 100%;
        }
        
        .text-element {
            position: absolute;
            cursor: move;
            min-width: 100px;
            min-height: 40px;
            padding: 5px;
            border: 1px dashed transparent;
        }
        
        .text-element:hover {
            border-color: var(--accent-color);
        }
        
        .text-element.selected {
            border: 2px solid var(--accent-color);
            background: rgba(76, 181, 245, 0.1);
        }
        
        .status-bar {
            background: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #ddd;
            font-size: 14px;
        }
        
        .document-info {
            color: #6c757d;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 450px;
            max-width: 90%;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        }
        
        .modal h3 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-group input, 
        .form-group textarea, 
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .text-controls {
            display: none;
            position: absolute;
            top: -45px;
            left: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .text-controls button {
            padding: 6px 10px;
            margin: 0 3px;
            background: var(--light-color);
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: var(--accent-color);
            width: 0%;
            transition: width 0.3s;
        }
        
        @media (max-width: 992px) {
            .main-content {
                flex-direction: column;
            }
            
            .toolbar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Editor de PDFs Avanzado</h1>
            <p class="app-description">Edita, personaliza y modifica tus documentos PDF con facilidad</p>
        </header>
        
        <div class="main-content">
            <div class="toolbar">
                <div class="toolbar-section">
                    <h3>Archivo PDF</h3>
                    <button class="btn" id="selectFiles">
                        <i>üìÅ</i> Cargar PDF
                    </button>
                    <input type="file" id="fileInput" accept=".pdf" style="display: none;">
                    <button class="btn btn-success" id="saveBtn">
                        <i>üíæ</i> Guardar PDF
                    </button>
                    <button class="btn" id="downloadBtn">
                        <i>üì•</i> Descargar PDF
                    </button>
                </div>
                
                <div class="toolbar-section">
                    <h3>Herramientas de Texto</h3>
                    <button class="btn" id="addTextBtn">
                        <i>‚úèÔ∏è</i> Agregar Texto
                    </button>
                    <button class="btn" id="editTextBtn">
                        <i>üìù</i> Editar Texto
                    </button>
                    <button class="btn btn-danger" id="deleteTextBtn">
                        <i>üóëÔ∏è</i> Eliminar Texto
                    </button>
                    
                    <div class="format-options">
                        <button class="btn" id="boldBtn"><b>B</b></button>
                        <button class="btn" id="italicBtn"><i>I</i></button>
                        <button class="btn" id="underlineBtn"><u>U</u></button>
                    </div>
                    
                    <div class="form-group" style="margin-top: 15px;">
                        <label for="fontSize">Tama√±o de fuente</label>
                        <select id="fontSize" class="btn">
                            <option value="12">12px</option>
                            <option value="14">14px</option>
                            <option value="16" selected>16px</option>
                            <option value="18">18px</option>
                            <option value="20">20px</option>
                            <option value="24">24px</option>
                            <option value="28">28px</option>
                            <option value="32">32px</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="fontFamily">Fuente</label>
                        <select id="fontFamily" class="btn">
                            <option value="Arial" selected>Arial</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Courier New">Courier New</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Verdana">Verdana</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="textColor">Color de texto</label>
                        <input type="color" id="textColor" value="#000000" style="width: 100%; height: 40px;">
                    </div>
                </div>
                
                <div class="toolbar-section">
                    <h3>Im√°genes</h3>
                    <button class="btn" id="addImageBtn">
                        <i>üñºÔ∏è</i> Agregar Imagen
                    </button>
                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                </div>
                
                <div class="toolbar-section">
                    <h3>Documentos</h3>
                    <button class="btn btn-warning" id="mergeBtn">
                        <i>üîó</i> Fusionar PDFs
                    </button>
                    <button class="btn btn-danger" id="resetBtn">
                        <i>üîÑ</i> Reiniciar
                    </button>
                </div>
            </div>
            
            <div class="viewer-container">
                <div class="upload-section">
                    <div class="drop-area" id="dropArea">
                        <p>Arrastra y suelta tu archivo PDF aqu√≠</p>
                        <p>o</p>
                        <button class="btn" id="selectFilesBtn">Seleccionar archivo PDF</button>
                    </div>
                </div>
                
                <div class="pdf-container" id="pdfContainer">
                    <canvas id="pdf-canvas"></canvas>
                    <!-- Los elementos de texto se agregar√°n aqu√≠ din√°micamente -->
                </div>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="document-info" id="docInfo">No hay documento cargado</div>
            <div class="document-info" id="docType">Tipo: Desconocido</div>
            <div class="document-info" id="pageInfo">P√°gina: -/-</div>
        </div>
    </div>
    
    <!-- Modal para agregar/editar texto -->
    <div class="modal" id="textModal">
        <div class="modal-content">
            <h3 id="textModalTitle">Agregar Texto</h3>
            <div class="form-group">
                <label for="textInput">Texto:</label>
                <textarea id="textInput" placeholder="Escribe tu texto aqu√≠..."></textarea>
            </div>
            <div class="form-group">
                <label for="textAlignment">Alineaci√≥n:</label>
                <select id="textAlignment">
                    <option value="left">Izquierda</option>
                    <option value="center" selected>Centro</option>
                    <option value="right">Derecha</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-danger" id="cancelTextBtn">Cancelar</button>
                <button class="btn btn-success" id="saveTextBtn">Guardar Texto</button>
            </div>
        </div>
    </div>
    
    <!-- Modal de progreso -->
    <div class="modal" id="progressModal">
        <div class="modal-content">
            <h3 id="progressTitle">Procesando PDF</h3>
            <p id="progressMessage">Analizando documento, por favor espere...</p>
            <div class="progress-bar">
                <div class="progress" id="progressBar"></div>
            </div>
            <p id="progressText">0%</p>
        </div>
    </div>

    <script>
        // Variables globales
        let currentPdf = null;
        let currentPageNum = 1;
        let pdfDoc = null;
        let isOCRDocument = false;
        let canvas = null;
        let ctx = null;
        let textElements = [];
        let selectedElement = null;
        let isEditMode = false;
        let isDeleteMode = false;
        
        // Inicializar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });
        
        function initApp() {
            // Configuraci√≥n de PDF.js
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';
            
            // Obtener elementos del DOM
            canvas = document.getElementById('pdf-canvas');
            ctx = canvas.getContext('2d');
            
            // Inicializar event listeners
            initEventListeners();
        }
        
        function initEventListeners() {
            // Eventos para cargar PDF
            document.getElementById('selectFilesBtn').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
            
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            
            const dropArea = document.getElementById('dropArea');
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.style.backgroundColor = 'rgba(76, 181, 245, 0.2)';
            });
            
            dropArea.addEventListener('dragleave', () => {
                dropArea.style.backgroundColor = '';
            });
            
            dropArea.addEventListener('drop', handleFileDrop);
            
            // Eventos para botones de texto
            document.getElementById('addTextBtn').addEventListener('click', addTextElement);
            document.getElementById('editTextBtn').addEventListener('click', enableEditMode);
            document.getElementById('deleteTextBtn').addEventListener('click', enableDeleteMode);
            document.getElementById('boldBtn').addEventListener('click', () => applyFormatting('bold'));
            document.getElementById('italicBtn').addEventListener('click', () => applyFormatting('italic'));
            document.getElementById('underlineBtn').addEventListener('click', () => applyFormatting('underline'));
            
            // Eventos para el modal de texto
            document.getElementById('saveTextBtn').addEventListener('click', saveTextElement);
            document.getElementById('cancelTextBtn').addEventListener('click', closeTextModal);
            
            // Eventos para otros botones
            document.getElementById('saveBtn').addEventListener('click', savePdf);
            document.getElementById('downloadBtn').addEventListener('click', downloadPdf);
            document.getElementById('addImageBtn').addEventListener('click', () => {
                document.getElementById('imageInput').click();
            });
            document.getElementById('imageInput').addEventListener('change', addImageToPdf);
            document.getElementById('mergeBtn').addEventListener('click', mergePdfs);
            document.getElementById('resetBtn').addEventListener('click', resetApp);
            
            // Eventos para cambios de formato
            document.getElementById('fontSize').addEventListener('change', updateTextStyle);
            document.getElementById('fontFamily').addEventListener('change', updateTextStyle);
            document.getElementById('textColor').addEventListener('change', updateTextStyle);
            document.getElementById('textAlignment').addEventListener('change', updateTextStyle);
        }
        
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                loadPdf(file);
            }
        }
        
        function handleFileDrop(e) {
            e.preventDefault();
            const dropArea = document.getElementById('dropArea');
            dropArea.style.backgroundColor = '';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                loadPdf(files[0]);
            }
        }
        
        function loadPdf(file) {
            if (file.type !== 'application/pdf') {
                alert('Por favor, selecciona un archivo PDF v√°lido.');
                return;
            }
            
            showProgressModal('Cargando PDF...');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const typedarray = new Uint8Array(e.target.result);
                
                pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                    pdfDoc = pdf;
                    currentPdf = pdf;
                    
                    // Detectar tipo de documento
                    detectDocumentType(pdf).then(isOCR => {
                        isOCRDocument = isOCR;
                        document.getElementById('docType').textContent = `Tipo: ${isOCR ? 'Escaneado (OCR)' : 'Digital'}`;
                        
                        // Renderizar la primera p√°gina
                        renderPage(1);
                        
                        // Actualizar informaci√≥n del documento
                        document.getElementById('docInfo').textContent = `Documento: ${file.name}`;
                        document.getElementById('pageInfo').textContent = `P√°gina: 1/${pdf.numPages}`;
                        
                        hideProgressModal();
                    });
                }).catch(error => {
                    console.error('Error al cargar el PDF:', error);
                    hideProgressModal();
                    alert('Error al cargar el PDF. Aseg√∫rate de que es un archivo v√°lido.');
                });
            };
            reader.readAsArrayBuffer(file);
        }
        
        function detectDocumentType(pdf) {
            return new Promise((resolve) => {
                // Obtener la primera p√°gina para an√°lisis
                pdf.getPage(1).then(page => {
                    page.getTextContent().then(textContent => {
                        // Si el PDF tiene texto, es probablemente digital
                        if (textContent.items.length > 0) {
                            resolve(false);
                        } else {
                            // Si no tiene texto, es probablemente escaneado
                            resolve(true);
                        }
                    });
                });
            });
        }
        
        function renderPage(pageNum) {
            if (!pdfDoc) return;
            
            showProgressModal('Cargando p√°gina...');
            
            pdfDoc.getPage(pageNum).then(page => {
                const viewport = page.getViewport({ scale: 1.5 });
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                
                page.render(renderContext).promise.then(() => {
                    currentPageNum = pageNum;
                    document.getElementById('pageInfo').textContent = `P√°gina: ${pageNum}/${pdfDoc.numPages}`;
                    hideProgressModal();
                    
                    // Volver a renderizar elementos de texto
                    renderTextElements();
                });
            });
        }
        
        function addTextElement() {
            // Mostrar modal para agregar texto
            document.getElementById('textModalTitle').textContent = 'Agregar Texto';
            document.getElementById('textInput').value = '';
            document.getElementById('textAlignment').value = 'center';
            document.getElementById('textModal').style.display = 'flex';
            
            // Configurar para crear nuevo elemento al guardar
            selectedElement = null;
        }
        
        function enableEditMode() {
            isEditMode = true;
            isDeleteMode = false;
            alert('Modo edici√≥n activado. Haz clic en un texto para editarlo.');
        }
        
        function enableDeleteMode() {
            isDeleteMode = true;
            isEditMode = false;
            alert('Modo eliminaci√≥n activado. Haz clic en un texto para eliminarlo.');
        }
        
        function editTextElement(element) {
            // Mostrar modal para editar texto
            document.getElementById('textModalTitle').textContent = 'Editar Texto';
            document.getElementById('textInput').value = element.text;
            document.getElementById('textAlignment').value = element.alignment || 'center';
            document.getElementById('textModal').style.display = 'flex';
            
            // Establecer el elemento seleccionado
            selectedElement = element;
        }
        
        function saveTextElement() {
            const text = document.getElementById('textInput').value;
            const alignment = document.getElementById('textAlignment').value;
            
            if (!text.trim()) {
                alert('Por favor, ingresa un texto v√°lido.');
                return;
            }
            
            if (selectedElement) {
                // Editar elemento existente
                selectedElement.text = text;
                selectedElement.alignment = alignment;
            } else {
                // Crear nuevo elemento de texto
                const newElement = {
                    id: Date.now(),
                    text: text,
                    x: 100,
                    y: 100,
                    fontSize: parseInt(document.getElementById('fontSize').value),
                    fontFamily: document.getElementById('fontFamily').value,
                    color: document.getElementById('textColor').value,
                    alignment: alignment,
                    bold: false,
                    italic: false,
                    underline: false
                };
                
                textElements.push(newElement);
                selectedElement = newElement;
            }
            
            // Renderizar elementos de texto
            renderTextElements();
            
            // Cerrar modal
            closeTextModal();
        }
        
        function closeTextModal() {
            document.getElementById('textModal').style.display = 'none';
        }
        
        function deleteTextElement(element) {
            if (confirm('¬øEst√°s seguro de que deseas eliminar este texto?')) {
                // Eliminar elemento
                textElements = textElements.filter(el => el.id !== element.id);
                
                // Volver a renderizar
                renderTextElements();
            }
        }
        
        function applyFormatting(format) {
            if (!selectedElement) {
                alert('Por favor, selecciona un texto primero haciendo clic en √©l.');
                return;
            }
            
            // Aplicar formato
            switch (format) {
                case 'bold':
                    selectedElement.bold = !selectedElement.bold;
                    break;
                case 'italic':
                    selectedElement.italic = !selectedElement.italic;
                    break;
                case 'underline':
                    selectedElement.underline = !selectedElement.underline;
                    break;
            }
            
            // Actualizar renderizado
            renderTextElements();
        }
        
        function updateTextStyle() {
            if (!selectedElement) return;
            
            selectedElement.fontSize = parseInt(document.getElementById('fontSize').value);
            selectedElement.fontFamily = document.getElementById('fontFamily').value;
            selectedElement.color = document.getElementById('textColor').value;
            
            renderTextElements();
        }
        
        function renderTextElements() {
            // Limpiar el canvas
            if (pdfDoc) {
                renderPage(currentPageNum);
            }
            
            // Renderizar cada elemento de texto
            textElements.forEach(element => {
                renderTextElement(element);
            });
        }
        
        function renderTextElement(element) {
            // Crear elemento div para el texto
            let textDiv = document.getElementById(`text-${element.id}`);
            
            if (!textDiv) {
                textDiv = document.createElement('div');
                textDiv.id = `text-${element.id}`;
                textDiv.className = 'text-element';
                textDiv.style.position = 'absolute';
                document.getElementById('pdfContainer').appendChild(textDiv);
                
                // Agregar evento de clic
                textDiv.addEventListener('click', () => {
                    selectTextElement(element);
                });
            }
            
            // Aplicar estilos
            textDiv.style.left = `${element.x}px`;
            textDiv.style.top = `${element.y}px`;
            textDiv.style.fontSize = `${element.fontSize}px`;
            textDiv.style.fontFamily = element.fontFamily;
            textDiv.style.color = element.color;
            textDiv.style.textAlign = element.alignment;
            textDiv.style.fontWeight = element.bold ? 'bold' : 'normal';
            textDiv.style.fontStyle = element.italic ? 'italic' : 'normal';
            textDiv.style.textDecoration = element.underline ? 'underline' : 'none';
            
            // Establecer contenido
            textDiv.textContent = element.text;
            
            // Si es el elemento seleccionado, resaltarlo
            if (selectedElement && selectedElement.id === element.id) {
                textDiv.classList.add('selected');
            } else {
                textDiv.classList.remove('selected');
            }
        }
        
        function selectTextElement(element) {
            if (isEditMode) {
                editTextElement(element);
                isEditMode = false;
                return;
            }
            
            if (isDeleteMode) {
                deleteTextElement(element);
                isDeleteMode = false;
                return;
            }
            
            // Seleccionar el elemento
            selectedElement = element;
            
            // Actualizar controles de formato
            document.getElementById('fontSize').value = element.fontSize;
            document.getElementById('fontFamily').value = element.fontFamily;
            document.getElementById('textColor').value = element.color;
            
            // Renderizar para mostrar la selecci√≥n
            renderTextElements();
        }
        
        function addImageToPdf(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            alert('Funcionalidad de agregar imagen se implementar√≠a aqu√≠. En una aplicaci√≥n real, se permitir√≠a colocar im√°genes en el PDF.');
            // En una implementaci√≥n real, aqu√≠ procesar√≠as la imagen y la agregar√≠as al PDF
        }
        
        function savePdf() {
            showProgressModal('Guardando PDF...');
            
            // Simular proceso de guardado
            setTimeout(() => {
                hideProgressModal();
                alert('PDF guardado correctamente. En una aplicaci√≥n real, se guardar√≠an todos los cambios.');
            }, 1500);
        }
        
        function downloadPdf() {
            showProgressModal('Generando PDF para descarga...');
            
            // Simular proceso de generaci√≥n de PDF
            setTimeout(() => {
                hideProgressModal();
                
                // Crear un enlace de descarga
                const link = document.createElement('a');
                link.href = canvas.toDataURL();
                link.download = 'documento_editado.pdf';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert('PDF descargado. En una aplicaci√≥n real, se generar√≠a un PDF con todo el contenido editado.');
            }, 2000);
        }
        
        function mergePdfs() {
            alert('Funcionalidad de fusionar PDFs se implementar√≠a aqu√≠. En una aplicaci√≥n real, se permitir√≠a combinar m√∫ltiples PDFs.');
        }
        
        function resetApp() {
            if (confirm("¬øEst√°s seguro de que deseas reiniciar? Se perder√°n todos los cambios.")) {
                // Limpiar todo
                pdfDoc = null;
                currentPdf = null;
                textElements = [];
                selectedElement = null;
                
                // Limpiar canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Eliminar elementos de texto
                document.querySelectorAll('.text-element').forEach(el => el.remove());
                
                // Restablecer informaci√≥n
                document.getElementById('docInfo').textContent = 'No hay documento cargado';
                document.getElementById('docType').textContent = 'Tipo: Desconocido';
                document.getElementById('pageInfo').textContent = 'P√°gina: -/-';
            }
        }
        
        function showProgressModal(message) {
            document.getElementById('progressMessage').textContent = message;
            document.getElementById('progressModal').style.display = 'flex';
        }
        
        function hideProgressModal() {
            document.getElementById('progressModal').style.display = 'none';
        }
    </script>
</body>
</html>
